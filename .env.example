# AFI-Reactor Environment Variables (Example)
# Copy this file to .env and fill in your actual values
# DO NOT commit .env to version control

# ========================================
# HTTP Server Configuration
# ========================================

# Port for the AFI-Reactor HTTP server
AFI_REACTOR_PORT=8080

# Optional shared secret for webhook authentication.
# If set, ingest endpoints (TradingView + CPJ collectors) should include this secret.
# WEBHOOK_SHARED_SECRET=your-secret-here

# ========================================
# MongoDB Configuration (Phase 1: TSSD Vault)
# ========================================

# MongoDB connection URI (Atlas or local)
# Example (Atlas): mongodb+srv://afi_app:YOUR_PASSWORD@cluster0.abc123.mongodb.net/?retryWrites=true&w=majority&appName=AFI
# Example (Local): mongodb://localhost:27017
AFI_MONGO_URI=mongodb+srv://afi_app:YOUR_PASSWORD@cluster0.abc123.mongodb.net/?retryWrites=true&w=majority&appName=AFI

# Database name for AFI data
AFI_MONGO_DB_NAME=afi

# Collection name for TSSD (Time-Series Signal Data) vault
AFI_MONGO_COLLECTION_TSSD=tssd_signals

# ========================================
# CPJ Ingestion (Canonical Parsed JSON)
# ========================================

# CPJ ingestion endpoint URL that collectors POST into.
# Usually points at this same reactor instance.
AFI_CPJ_INGEST_URL=http://localhost:8080/api/ingest/cpj

# Optional: collector-side confidence gating (endpoint may still accept CPJ that passes schema)
AFI_CPJ_MIN_CONFIDENCE=0.55

# Optional: in-memory dedupe guard (ingestHash-based)
AFI_INGEST_DEDUPE=1
AFI_INGEST_DEDUPE_TTL_MINUTES=60
AFI_INGEST_DEDUPE_MAX_SIZE=10000

# ========================================
# Telegram Collector (Bot API)
# Works for: groups/channels where your BOT is present (and channels where it is admin)
# Does NOT work for: arbitrary public channels you don't control (use MTProto user-client)
# ========================================

AFI_TELEGRAM_ENABLED=0
AFI_TELEGRAM_TOKEN=your-bot-token
AFI_TELEGRAM_CHANNELS=@channel1,@channel2
AFI_TELEGRAM_POLL_INTERVAL_MS=5000

# ========================================
# Telegram Collector (MTProto User Client)
# Works for: arbitrary public channels the logged-in user account can join
# Requires: api_id + api_hash from https://my.telegram.org and a phone-based login
# ========================================

AFI_TELEGRAM_MTPROTO_ENABLED=0
AFI_TELEGRAM_MTPROTO_API_ID=12345678
AFI_TELEGRAM_MTPROTO_API_HASH=your-api-hash
AFI_TELEGRAM_MTPROTO_PHONE=+15551234567
AFI_TELEGRAM_MTPROTO_CHANNELS=@publicchannel1,@publicchannel2

# Optional: persist session + collector state across restarts (recommended)
AFI_TELEGRAM_MTPROTO_SESSION_PATH=./.secrets/telegram.session
AFI_TELEGRAM_MTPROTO_STATE_PATH=./.secrets/telegram_mtproto.state.json

# Optional: startup behavior controls
AFI_TELEGRAM_MTPROTO_FETCH_HISTORY=0
AFI_TELEGRAM_MTPROTO_HISTORY_LIMIT=50
AFI_TELEGRAM_MTPROTO_THROTTLE_MS=500

# ========================================
# Price Feed Configuration
# ========================================

# Price feed source: "demo" (mock data), "blofin" (BloFin exchange), or "coinbase" (Coinbase exchange)
# Default: "demo"
# - "demo": Mock data (no external API calls)
# - "blofin": Real price data from BloFin exchange (spot + perps)
# - "coinbase": Real price data from Coinbase exchange (spot only)
AFI_PRICE_FEED_SOURCE=demo

# BloFin API base URL (optional, uses ccxt default if not set)
# Only needed if using a custom BloFin API endpoint
# BLOFIN_API_BASE_URL=https://api.blofin.com

# Coinbase API base URL (optional, uses ccxt default if not set)
# Only needed if using a custom Coinbase API endpoint
# COINBASE_API_BASE_URL=https://api.coinbase.com

# ========================================
# Sentiment Data Configuration
# ========================================

# Coinalyze API key for perp sentiment enrichment (funding rates, open interest)
# Get your API key from: https://coinalyze.net
# If not set, sentiment enrichment will be skipped (fail-soft)
# COINALYZE_API_KEY=your-coinalyze-api-key-here

# ========================================
# Pattern Regime Data Configuration
# ========================================

# Pattern regime enrichment provider (default: blofin)
# Options:
#   - "blofin"    : Use BloFin exchange OHLC data (recommended, no rate limits)
#   - "coinbase"  : Use Coinbase exchange OHLC data (fallback)
#   - "coingecko" : Use CoinGecko public API (legacy, has rate limits)
#   - "off"       : Disable regime enrichment (returns "unknown" regime)
PATTERN_REGIME_PROVIDER=blofin

# Timeframe for regime candles (default: 4h)
# Common values: 1h, 4h, 1d
# Higher timeframes = smoother regime detection, fewer API calls
PATTERN_REGIME_TIMEFRAME=4h

# Lookback period in days (default: 90)
# How many days of historical data to fetch for regime computation
PATTERN_REGIME_LOOKBACK_DAYS=90

# Cache TTL in minutes (default: 15)
# How long to cache regime candles before refetching
# Prevents redundant API calls for multiple alerts on same symbol
PATTERN_REGIME_CACHE_TTL_MINUTES=15

# Fear & Greed Index (external sentiment overlay)
# Source: https://alternative.me/crypto/fear-and-greed-index/
# No API key required. Provides cycle phase context (fear/greed levels).
# If unavailable, regime computation continues without external sentiment.

# ========================================
# News Enrichment Configuration
# ========================================

# Choose which news provider to use for Froggy enrichment:
#   - "none"      : disable news enrichment (default if unset)
#   - "newsdata"  : use NewsData.io crypto news API
NEWS_PROVIDER=newsdata

# NewsData.io API key (required if NEWS_PROVIDER=newsdata)
# Sign up at https://newsdata.io/ for a free developer key.
# Free tier: 200 requests/day
# If not set, news enrichment will be disabled (fail-soft)
NEWSDATA_API_KEY=your-newsdata-api-key-here

# Optional: lookback window in hours for news queries (default: 4)
# This controls how far back to search for recent news headlines
# NOTE: NewsData.io free tier has ~6-8 hour delay, so use 24h window for better results
NEWS_WINDOW_HOURS=24

# ========================================
# AI/ML Enrichment Configuration (Tiny Brains)
# ========================================

# Base URL for Tiny Brains AI/ML microservice (optional)
# If set, Froggy enrichment will call this service to get ML predictions
# If not set or unavailable, enrichment continues without aiMl data (fail-soft)
# Example: http://localhost:8090
# TINY_BRAINS_URL=

# ========================================
# Notes
# ========================================
# - Replace YOUR_PASSWORD with your actual MongoDB password
# - If AFI_MONGO_URI is not set, TSSD vault will be disabled (graceful degradation)
# - All MongoDB env vars are optional for demo purposes
# - Set AFI_PRICE_FEED_SOURCE=blofin or AFI_PRICE_FEED_SOURCE=coinbase to use real exchange data
# - All exchange integrations are READ-ONLY (no order placement)
# - No real trading or AFI token minting occurs in this server
#
# Secrets hygiene:
# - Do NOT commit session/state files (recommended: add .secrets/ to .gitignore)
# - MTProto requires a one-time login code (and 2FA password if enabled) on first run